<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Earning App</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* তোমার CSS একই রাখা হয়েছে */
        /* ... (কোন পরিবর্তন করা হয়নি) ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- তোমার পুরো HTML অংশ আগের মতোই রাখা হয়েছে -->
        <!-- ... (কোন পরিবর্তন করা হয়নি) ... -->
    </div>

    <!-- ✅ নতুন SDK কোড যুক্ত করা হয়েছে -->
    <script src='//libtl.com/sdk.js' data-zone='10003816' data-sdk='show_10003816'></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            const userData = tg.initDataUnsafe.user;

            const navItems = document.querySelectorAll('.nav-item');
            const pages = document.querySelectorAll('.page');
            const watchAdBtn = document.getElementById('watch-ad-btn');
            const startEarningBtn = document.getElementById('start-earning-btn');
            const withdrawBtn = document.getElementById('withdraw-btn');
            const withdrawForm = document.getElementById('withdraw-form');

            const DAILY_ADS_LIMIT = 50;
            const AD_REWARD = 0.02; // BDT per ad
            const MIN_WITHDRAW_AMOUNT = 100;

            if (!localStorage.getItem('earnings')) {
                localStorage.setItem('earnings', '0');
                localStorage.setItem('adsWatched', '0');
                localStorage.setItem('totalReferrals', '0');
            }

            function updateUI() {
                const earnings = parseFloat(localStorage.getItem('earnings'));
                const adsWatched = parseInt(localStorage.getItem('adsWatched'));
                const referrals = parseInt(localStorage.getItem('totalReferrals'));
                const formattedEarnings = earnings.toFixed(2);

                document.getElementById('current-balance').textContent = `BDT ${formattedEarnings}`;
                document.getElementById('total-earnings').textContent = `BDT ${formattedEarnings}`;
                document.getElementById('ads-watched').textContent = adsWatched;
                document.getElementById('total-referrals').textContent = referrals;
                document.getElementById('ad-progress-text').textContent = `Completed: ${adsWatched} / ${DAILY_ADS_LIMIT}`;
                document.getElementById('ad-progress-bar').style.width = `${(adsWatched / DAILY_ADS_LIMIT) * 100}%`;
            }

            function showPage(targetPageId) {
                navItems.forEach(nav => nav.classList.remove('active'));
                pages.forEach(page => page.classList.remove('active'));
                document.querySelector(`[data-page="${targetPageId}"]`).classList.add('active');
                document.getElementById(targetPageId).classList.add('active');
            }

            navItems.forEach(item => {
                item.addEventListener('click', () => showPage(item.getAttribute('data-page')));
            });

            startEarningBtn.addEventListener('click', () => showPage('earn-page'));
            withdrawBtn.addEventListener('click', () => showPage('withdraw-page'));

            // ✅ এখানে নতুন SDK কল যুক্ত করা হয়েছে
            watchAdBtn.addEventListener('click', () => {
                if (parseInt(localStorage.getItem('adsWatched')) >= DAILY_ADS_LIMIT) {
                    tg.showAlert('আপনার দৈনিক বিজ্ঞাপনের সীমা পৌঁছে গেছে।');
                    return;
                }

                watchAdBtn.disabled = true;

                // ✅ নতুন SDK ফাংশন ব্যবহৃত হচ্ছে
                if (typeof show_10003816 === 'function') {
                    show_10003816('pop').then(() => {
                        let earnings = parseFloat(localStorage.getItem('earnings')) + AD_REWARD;
                        let currentAdsWatched = parseInt(localStorage.getItem('adsWatched')) + 1;

                        localStorage.setItem('earnings', earnings.toString());
                        localStorage.setItem('adsWatched', currentAdsWatched.toString());

                        tg.showAlert(`বিজ্ঞাপনটি দেখার জন্য আপনি BDT ${AD_REWARD.toFixed(2)} পেয়েছেন!`);
                    }).catch(e => {
                        tg.showAlert('বিজ্ঞাপন দেখাতে সমস্যা হয়েছে, আবার চেষ্টা করুন।');
                    }).finally(() => {
                        updateUI();
                        watchAdBtn.disabled = false;
                    });
                } else {
                    alert('(Test Mode) You earned BDT ' + AD_REWARD.toFixed(2));
                    let earnings = parseFloat(localStorage.getItem('earnings')) + AD_REWARD;
                    let currentAdsWatched = parseInt(localStorage.getItem('adsWatched')) + 1;
                    localStorage.setItem('earnings', earnings.toString());
                    localStorage.setItem('adsWatched', currentAdsWatched.toString());
                    updateUI();
                    watchAdBtn.disabled = false;
                }
            });

            withdrawForm.addEventListener('submit', e => {
                e.preventDefault();
                const amount = parseFloat(document.getElementById('withdraw-amount').value);
                tg.showAlert(`আপনার উইথড্র অনুরোধ জমা হয়েছে BDT ${amount.toFixed(2)} এর জন্য।`);
                withdrawForm.reset();
            });

            updateUI();
        });
    </script>
</body>
</html>
